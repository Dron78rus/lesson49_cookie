<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <style>
      p {
        font-weight: bold;
      }
      .topic {
        text-decoration: underline;
        margin: 10px;
      }
      .task {
        margin: 20px 10px;
      }
      .container {
        padding-bottom: 15px;
        border-bottom: 1px black solid;
      }
      .symbolOK,
      .dateEntered {
        display: inline;
        visibility: hidden;
      }
      .confirmationOfInput {
        height: 24px;
        margin: 0 5px 0 5px;
      }
      .entryField {
        display: block;
      }
    </style>

    <p>Задание 1</p>

    <div class="topic">Основы работы</div>
    <div class="task">
      Установите куку с именем 'name' и значением 'Иван'. Выведите содержимое
      этой куки на экран.
    </div>

    <div class="container divT1"></div>

    <p>Задание 2</p>

    <div class="task">
      Установите куку с вашем именем и вашим возрастом. Выведите на экран
      содержимое этих двух кук.
    </div>

    <div class="container divT2"></div>

    <p>Задание 3</p>

    <div class="topic">Практика</div>
    <div class="task">
      Дан инпут. Ведите в него город, например, Минск. Сохраните его в куки.
      Зайдя на другую страницу сайта вы должны увидеть фразу 'ваш город -
      Минск'.
    </div>

    <input type="text" placeholder="Введите город" class="city" />
    <div class="symbolOK">
      &#9989; Название города сохранено в памяти, перезагрузите страницу
    </div>
    <div class="container divT3"></div>

    <p>Задание 4</p>

    <div class="task">
      При заходе на страницу спросите с помощью инпута день рождения
      пользователя. Когда он зайдет в следующий раз - напишите, сколько месяцев,
      дней, часов, минут и секунд осталось до его дня рождения. И пусть по этим
      числам запустится обратный отсчет (то есть они будут тикать).
    </div>

    <input type="date" class="dateOfBirth" /><input
      type="button"
      value="готово"
      class="confirmationOfInput"
    />
    <div class="dateEntered">
      &#9989; Дата сохранена в памяти, перезагрузите страницу
    </div>
    <div class="container divT4">введите дату рождения</div>

    <p>Задание 5</p>

    <div class="task">
      Дана форма с инпутами. Пользователь вводит какие-то данные и закрывает
      страницу (не факт, что он заполнил всю форму). Сделайте так, чтобы при
      следующем заходе на страницу введенные им ранее данные стояли на своих
      местах.
    </div>

    <input type="text" class="someTextTask5_1" /><input
      type="button"
      value="готово"
      class="confirmationOfInputTask5_1"
    />
    <br /><input type="text" class="someTextTask5_2" /><input
      type="button"
      value="готово"
      class="confirmationOfInputTask5_2"
    />
    <br /><input type="text" class="someTextTask5_3" /><input
      type="button"
      value="готово"
      class="confirmationOfInputTask5_3"
    />
    <br />
    <input type="text" class="entryField someTextTask5_4" />
    <input type="text" class="entryField someTextTask5_5" />
    <input type="text" class="entryField someTextTask5_6" />

    <div class="container divT5"></div>

    <p>Задание 6</p>

    <div class="task">
      Даны чекбоксы. Пользователь произвольно отмечает их и закрывает страницу.
      Сделайте так, чтобы при следующем заходе на страницу чекбоксы стали
      отмеченными так, как это сделал пользователь ранее.
    </div>

    <script>
      // http://old.code.mu/tasks/javascript/advanced/rabota-s-kuki-v-javascript.html

      // задание 1

      const d = document
      const divT1 = d.querySelector('.divT1')

      function outputOfResult(parent, receivedValue, initialValue = 'none') {
        if (initialValue !== 'none') {
          const sourceString = `Исходная строка: ${initialValue}`
          const newDiv = d.createElement('div')
          parent.appendChild(newDiv)
          newDiv.innerHTML = sourceString
        }

        const modifiedString = `Результат: ${receivedValue}`
        const newDiv2 = d.createElement('div')
        parent.appendChild(newDiv2)
        newDiv2.innerHTML = modifiedString
      }

      function getCookie(name) {
        let matches = d.cookie.match(
          new RegExp(
            '(?:^|; )' +
              name.replace(/([\.$?*\+\\\/{}|\(\)\[\]^])/g, '\\$1') +
              '=(.*?)(?:;|$)'
          )
        )
        console.log(matches)
        return matches ? decodeURIComponent(matches[1]) : undefined
        //matches.input

        // let matches = document.cookie.match(
        //   new RegExp(
        //     '(?:^|; )' +
        // name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') +
        // '=([^;]*)'
        //   )
        // )
        // return matches ? decodeURIComponent(matches[1]) : undefined
      }

      d.cookie = 'name=Иван'
      const str = getCookie('name')

      outputOfResult(divT1, str)

      // задание 2

      const divT2 = d.querySelector('.divT2')
      d.cookie = 'MyName=Andrey'
      d.cookie = 'myAge=37'
      const str2 = getCookie('MyName')
      const str3 = getCookie('myAge')

      outputOfResult(divT2, str2)
      outputOfResult(divT2, str3)

      // задание 3

      const divT3 = d.querySelector('.divT3')
      const enteredCity = d.querySelector('.city')
      const symbolOK = d.querySelector('.symbolOK')

      enteredCity.addEventListener('keydown', function (e) {
        if (e.keyCode === 13) {
          d.cookie = `yourCity=${enteredCity.value}`
          symbolOK.style.visibility = 'visible'
        }
      })

      const str4 = `ваш город - ${getCookie('yourCity')}`

      outputOfResult(divT3, str4)

      // задание 4

      const divT4 = d.querySelector('.divT4')
      const dateOfBirth = d.querySelector('.dateOfBirth')
      const dateEntered = d.querySelector('.dateEntered')
      const confirmationOfInput = d.querySelector('.confirmationOfInput')

      function storeDateValue() {
        d.cookie = `yourDateOfBirth=${dateOfBirth.value}`
        dateEntered.style.visibility = 'visible'
        confirmationOfInput.value = 'Остановить таймер'
        confirmationOfInput.removeEventListener('click', storeDateValue)
        confirmationOfInput.addEventListener('click', stopTimer)
      }

      function stopTimer() {
        clearInterval(timerId)
        confirmationOfInput.value = 'Ввести дату'
        confirmationOfInput.addEventListener('click', storeDateValue)
      }

      confirmationOfInput.addEventListener('click', storeDateValue)

      if (
        getCookie('yourDateOfBirth') !== '' ||
        getCookie('yourDateOfBirth') !== undefined
      ) {
        startCounting()

        confirmationOfInput.removeEventListener('click', storeDateValue)
        confirmationOfInput.addEventListener('click', stopTimer)
      }

      function startCounting() {
        confirmationOfInput.value = 'Остановить таймер'
        timerId = setInterval(() => {
          const todaysDate = new Date()
          const monthOfBirth =
            getCookie('yourDateOfBirth').match(/-(\d\d)-(\d\d)/)[1]
          const dayOfBirth =
            getCookie('yourDateOfBirth').match(/-(\d\d)-(\d\d)/)[2]
          let numberOfMonths = monthOfBirth - todaysDate.getMonth()
          let numberOfDays = dayOfBirth - todaysDate.getDate()
          const numberOfHours = 24 - todaysDate.getHours()
          const numberOfMinutes = 59 - todaysDate.getMinutes()
          const numberOfSeconds = 59 - todaysDate.getSeconds()

          if (monthOfBirth > todaysDate.getMonth()) {
            numberOfMonths = numberOfMonths - 1
          } else {
            numberOfMonths = numberOfMonths + 10
          }

          if (
            monthOfBirth == todaysDate.getMonth() + 1 &&
            dayOfBirth > todaysDate.getDate()
          ) {
            numberOfMonths = numberOfMonths
          }

          if (
            monthOfBirth == todaysDate.getMonth() + 1 &&
            dayOfBirth < todaysDate.getDate()
          ) {
            numberOfMonths = numberOfMonths + 11
          }

          if (dayOfBirth > todaysDate.getDate()) {
            numberOfDays = numberOfDays - 1
          } else {
            numberOfDays = numberOfDays + 30
          }

          const str = `время до вашего дня рождения ${numberOfMonths} месяцев: ${numberOfDays} дней: ${numberOfHours} часов: ${numberOfMinutes} минут: ${numberOfSeconds} секунд`
          divT4.removeChild(divT4.firstChild)
          outputOfResult(divT4, str)
        }, 1000)
      }

      // задание 5

      const divT5 = d.querySelector('.divT5')
      const someTextTask5_1 = d.querySelector('.someTextTask5_1')
      const someTextTask5_2 = d.querySelector('.someTextTask5_2')
      const someTextTask5_3 = d.querySelector('.someTextTask5_3')
      const someTextTask5_4 = d.querySelector('.someTextTask5_4')
      const someTextTask5_5 = d.querySelector('.someTextTask5_5')
      const someTextTask5_6 = d.querySelector('.someTextTask5_6')

      const entryField = d.querySelectorAll('.entryField')

      function getCookie2(name) {
        let matches = d.cookie.match(
          new RegExp(
            '(?:^|; )' +
              'entryField ' +
              name.replace(/([\.$?*\+\\\/{}|\(\)\[\]^])/g, '\\$1') +
              '=(.*?)(?:;|$)'
          )
        )
        console.log(matches)
        return matches ? decodeURIComponent(matches[1]) : undefined
      }

      const confirmationOfInputTask5_1 = d.querySelector(
        '.confirmationOfInputTask5_1'
      )
      const confirmationOfInputTask5_2 = d.querySelector(
        '.confirmationOfInputTask5_2'
      )
      const confirmationOfInputTask5_3 = d.querySelector(
        '.confirmationOfInputTask5_3'
      )

      // function insertDataIntoCookies(input) {
      //   d.cookie = `${input}=${input.value}`
      //   console.log(getCookie(`${input}`))
      //   console.log(`${input.value}`)
      // }
      // confirmationOfInputTask5_1.addEventListener(
      //   'click',
      //   insertDataIntoCookies.bind(someTextTask5_1)
      // )

      function savingChanges(e) {
        d.cookie = `${e.target.className}=${e.target.value}`
      }

      confirmationOfInputTask5_1.addEventListener('click', () => {
        d.cookie = `someTextTask5_1=${someTextTask5_1.value}`
      })

      confirmationOfInputTask5_2.addEventListener('click', () => {
        d.cookie = `someTextTask5_2=${someTextTask5_2.value}`
      })

      confirmationOfInputTask5_3.addEventListener('click', () => {
        d.cookie = `someTextTask5_3=${someTextTask5_3.value}`
      })

      for (let i = 0; i < entryField.length; i++) {
        entryField[i].addEventListener('input', savingChanges)
      }

      if (getCookie('someTextTask5_1') !== undefined) {
        someTextTask5_1.value = getCookie('someTextTask5_1')
      }
      if (getCookie('someTextTask5_2') !== undefined) {
        someTextTask5_2.value = getCookie('someTextTask5_2')
      }
      if (getCookie('someTextTask5_3') !== undefined) {
        someTextTask5_3.value = getCookie('someTextTask5_3')
      }
      if (getCookie2('someTextTask5_4') !== undefined) {
        someTextTask5_4.value = getCookie2('someTextTask5_4')
      }
      if (getCookie2('someTextTask5_5') !== undefined) {
        someTextTask5_5.value = getCookie2('someTextTask5_5')
      }
      if (getCookie2('someTextTask5_6') !== undefined) {
        someTextTask5_6.value = getCookie2('someTextTask5_6')
      }

      // задание 6
    </script>
  </body>
</html>
